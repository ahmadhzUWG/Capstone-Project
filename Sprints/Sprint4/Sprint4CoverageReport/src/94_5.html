<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\Nick\Desktop\Capstone-Project\code\TaskManager.Tests\WebsiteTests\TestControllers\AdminControllerTests.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Security.Claims;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Rendering;
using Microsoft.AspNetCore.Mvc.ViewFeatures;
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;
using Moq;
using TaskManager.Tests.WebsiteTests.Mocks;
using TaskManagerData.Models;
using TaskManagerWebsite.Controllers;
using TaskManagerWebsite.ViewModels;
using TaskManagerWebsite.ViewModels.ProjectViewModels;
using Task = System.Threading.Tasks.Task;

namespace TaskManager.Tests.WebsiteTests.TestControllers;

public class AdminControllerTests
{
    private readonly Mock&lt;UserManager&lt;User&gt;&gt; _mockUserManager;
    private readonly Mock&lt;RoleManager&lt;IdentityRole&lt;int&gt;&gt;&gt; _mockRoleManager;
    private readonly ApplicationDbContext _dbContext;

    public AdminControllerTests()
    {
        _mockUserManager = GetMockUserManager();
        _mockRoleManager = GetMockRoleManager();
        _dbContext = TestHelper.GetDbContext();

        var mockRoles = new List&lt;IdentityRole&lt;int&gt;&gt;
        {
            new IdentityRole&lt;int&gt; { Id = 1, Name = &quot;Admin&quot; },
            new IdentityRole&lt;int&gt; { Id = 2, Name = &quot;Employee&quot; }
        }.AsQueryable();
        _mockRoleManager.Setup(rm =&gt; rm.Roles).Returns(mockRoles);

        _mockUserManager.Setup(um =&gt; um.GetRolesAsync(It.IsAny&lt;User&gt;()))
            .ReturnsAsync(new List&lt;string&gt; { &quot;Admin&quot;, &quot;Manager&quot;, &quot;Employee&quot; });
    }

    private Mock&lt;UserManager&lt;User&gt;&gt; GetMockUserManager()
    {
        var userStoreMock = new Mock&lt;IUserStore&lt;User&gt;&gt;();
        return new Mock&lt;UserManager&lt;User&gt;&gt;(userStoreMock.Object,
            null, null, null, null, null, null, null, null);
    }

    private Mock&lt;RoleManager&lt;IdentityRole&lt;int&gt;&gt;&gt; GetMockRoleManager()
    {
        var roleStoreMock = new Mock&lt;IRoleStore&lt;IdentityRole&lt;int&gt;&gt;&gt;();
        return new Mock&lt;RoleManager&lt;IdentityRole&lt;int&gt;&gt;&gt;(roleStoreMock.Object,
            null, null, null, null);
    }

    // ––– Tests for User-related endpoints –––
    [Fact]
    public async Task UserAdd_InvalidModelState_ReturnsViewWithSameModel()
    {
        // Arrange
        var controller = new AdminController(this._dbContext, this._mockUserManager.Object, this._mockRoleManager.Object);

        controller.ModelState.AddModelError(&quot;UserName&quot;, &quot;UserName is required&quot;);

        var viewModel = new UserViewModel
        {
            UserName = &quot;&quot;,
            Email = &quot;test@example.com&quot;,
            Password = &quot;password&quot;,
            ConfirmPassword = &quot;password&quot;
        };

        // Act
        var result = await controller.UserAdd(viewModel);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.Equal(viewModel, viewResult.Model);
    }

    [Fact]
    public async Task Users_ReturnsViewWithUserList()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        dbContext.Users.Add(new User { Id = 1, UserName = &quot;User1&quot;, Email = &quot;user1@example.com&quot; });
        dbContext.Users.Add(new User { Id = 2, UserName = &quot;User2&quot;, Email = &quot;user2@example.com&quot; });
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.Users();

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var users = Assert.IsAssignableFrom&lt;IEnumerable&lt;User&gt;&gt;(viewResult.Model);
        Assert.Equal(2, users.Count());
    }

    [Fact]
    public async Task UserEdit_ReturnsNotFound_WithNoFoundUser()
    {
        var controller = new AdminController(_dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        var result = await controller.UserEdit(&quot;999&quot;);

        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task UserEdit_ReturnsViewResult_WithValidUser()
    {
        var controller = new AdminController(_dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        var user = new User { Id = 1, UserName = &quot;User1&quot;, Email = &quot;user1@example.com&quot; };
        await _dbContext.Users.AddAsync(user);
        await _dbContext.SaveChangesAsync();

        _mockUserManager.Setup(um =&gt; um.FindByIdAsync(user.Id.ToString())).ReturnsAsync(user);
        _mockUserManager.Setup(um =&gt; um.GetRolesAsync(user)).ReturnsAsync(new List&lt;string&gt; { &quot;Admin&quot; });

        _mockRoleManager.Setup(rm =&gt; rm.Roles).Returns(new List&lt;IdentityRole&lt;int&gt;&gt;
        {
            new IdentityRole&lt;int&gt; { Name = &quot;Admin&quot; },
            new IdentityRole&lt;int&gt; { Name = &quot;User&quot; }
        }.AsQueryable());

        var result = await controller.UserEdit(user.Id.ToString());

        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var model = Assert.IsType&lt;User&gt;(viewResult.Model);
        Assert.Equal(user.Id, model.Id);
        Assert.Equal(user.UserName, model.UserName);

        Assert.NotNull(controller.ViewBag.Roles);
        Assert.Contains(&quot;Admin&quot;, controller.ViewBag.Roles);
        Assert.Equal(&quot;Admin&quot;, controller.ViewBag.CurrentRole);
    }

    [Fact]
    public async Task UserAdd_ReturnsViewResult()
    {
        var controller = new AdminController(_dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        var result = controller.UserAdd();

        Assert.IsType&lt;ViewResult&gt;(result);
    }

    [Fact]
    public async Task UserDetails_ReturnsViewWithUser_IfExists()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var user = new User { Id = 10, UserName = &quot;DetailUser&quot;, Email = &quot;detail@example.com&quot; };
        dbContext.Users.Add(user);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.UserDetails(10);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var modelUser = Assert.IsType&lt;User&gt;(viewResult.Model);
        Assert.Equal(&quot;DetailUser&quot;, modelUser.UserName);
    }

    [Fact]
    public async Task UserDetails_ReturnsNotFound_IfUserDoesNotExist()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.UserDetails(999);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task UserDelete_ReturnsViewIfUserExists()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var user = new User { Id = 100, UserName = &quot;DeleteUser&quot;, Email = &quot;delete@example.com&quot; };
        dbContext.Users.Add(user);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.UserDelete(100);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var modelUser = Assert.IsType&lt;UserDeleteViewModel&gt;(viewResult.Model);
        Assert.Equal(&quot;DeleteUser&quot;, modelUser.User.UserName);
    }

    [Fact]
    public async Task UserDelete_ReturnsNotFoundIfUserDoesNotExist()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.UserDelete(999);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task DeleteConfirmed_DeletesUserAndRedirects()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var user = new User { Id = 200, UserName = &quot;ConfirmedUser&quot;, Email = &quot;confirmed@example.com&quot; };
        dbContext.Users.Add(user);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.DeleteConfirmed(200);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.False(dbContext.Users.Any(u =&gt; u.Id == 200));
    }

    // ––– Tests for Group-related endpoints –––

    [Fact]
    public async Task Groups_ReturnsViewWithGroupList()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        dbContext.Groups.Add(new Group { Id = 1, Name = &quot;Group1&quot;, Description = &quot;Test Description&quot; });
        dbContext.Groups.Add(new Group { Id = 2, Name = &quot;Group2&quot;, Description = &quot;Test Description&quot; });
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.Groups();

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var groups = Assert.IsAssignableFrom&lt;IEnumerable&lt;Group&gt;&gt;(viewResult.Model);
        Assert.Equal(2, groups.Count());
    }

    [Fact]
    public void CreateGroup_Get_ReturnsViewWithManagersAndEmployees()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var employeeUser = new User { Id = 2, UserName = &quot;EmployeeUser&quot;, Email = &quot;employee@example.com&quot; };
        dbContext.Users.Add(employeeUser);
        dbContext.SaveChanges();

        _mockUserManager.Setup(um =&gt; um.IsInRoleAsync(It.Is&lt;User&gt;(u =&gt; u.Id == 1), &quot;Manager&quot;))
            .ReturnsAsync(true);
        _mockUserManager.Setup(um =&gt; um.IsInRoleAsync(It.Is&lt;User&gt;(u =&gt; u.Id == 2), &quot;Manager&quot;))
            .ReturnsAsync(false);
        _mockUserManager.Setup(um =&gt; um.IsInRoleAsync(It.Is&lt;User&gt;(u =&gt; u.Id == 1), &quot;Employee&quot;))
            .ReturnsAsync(false);
        _mockUserManager.Setup(um =&gt; um.IsInRoleAsync(It.Is&lt;User&gt;(u =&gt; u.Id == 2), &quot;Employee&quot;))
            .ReturnsAsync(true);

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        var httpContext = new DefaultHttpContext();
        var services = new ServiceCollection()
            .AddSingleton&lt;ITempDataProvider&gt;(new Mock&lt;ITempDataProvider&gt;().Object)
            .AddSingleton(_mockUserManager.Object)
            .BuildServiceProvider();
        httpContext.RequestServices = services;

        controller.ControllerContext.HttpContext = httpContext;
        controller.TempData = new TempDataDictionary(httpContext, services.GetRequiredService&lt;ITempDataProvider&gt;());

        // Act
        var result = controller.CreateGroup();

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.NotNull(viewResult.ViewData[&quot;Employees&quot;]);
        var employees = viewResult.ViewData[&quot;Employees&quot;] as List&lt;User&gt;;
        Assert.Single(employees);
        Assert.Equal(&quot;EmployeeUser&quot;, employees.First().UserName);
    }

    [Fact]
    public async Task GroupDetails_ReturnsNotFoundIfGroupDoesNotExist()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.GroupDetails(999);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task GroupDetails_ReturnsViewWithUsersAndManagers()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var group = new Group
        {
            Id = 40,
            Name = &quot;GroupDetails&quot;,
            Description = &quot;Test Description&quot;
        };
        dbContext.Groups.Add(group);

        var managerUser = new User { Id = 1, UserName = &quot;ManagerUser&quot;, Email = &quot;manager@example.com&quot; };
        var employeeUser = new User { Id = 2, UserName = &quot;EmployeeUser&quot;, Email = &quot;employee@example.com&quot; };
        dbContext.Users.AddRange(managerUser, employeeUser);

        dbContext.UserGroups.Add(new UserGroup { GroupId = 40, UserId = 1, Role = &quot;Manager&quot; });
        dbContext.UserGroups.Add(new UserGroup { GroupId = 40, UserId = 2, Role = &quot;Member&quot; });

        await dbContext.SaveChangesAsync();

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.GroupDetails(40);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var modelGroup = Assert.IsType&lt;Group&gt;(viewResult.Model);
        Assert.Equal(&quot;GroupDetails&quot;, modelGroup.Name);

        Assert.NotNull(viewResult.ViewData[&quot;GroupUsers&quot;]);
        var groupUsers = viewResult.ViewData[&quot;GroupUsers&quot;] as List&lt;UserGroup&gt;;
        Assert.NotNull(groupUsers);
        Assert.Equal(2, groupUsers.Count);

        Assert.Contains(groupUsers, gu =&gt; gu.UserId == 1 &amp;&amp; gu.Role == &quot;Manager&quot;);
        Assert.Contains(groupUsers, gu =&gt; gu.UserId == 2 &amp;&amp; gu.Role == &quot;Member&quot;);
    }

    [Fact]
    public async Task CreateGroup_Post_InvalidPrimaryManager_ReturnsViewWithError()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();

        var groupViewModel = new GroupViewModel
        {
            Name = &quot;NewGroup&quot;,
            Description = &quot;Test Description&quot;,
            SelectedManagerId = 9,
            SelectedUserIds = [3]
        };
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        var services = new ServiceCollection()
            .AddSingleton&lt;ITempDataProvider&gt;(new Mock&lt;ITempDataProvider&gt;().Object)
            .AddSingleton&lt;UserManager&lt;User&gt;&gt;(_mockUserManager.Object)
            .BuildServiceProvider();

        var httpContext = new DefaultHttpContext();
        httpContext.RequestServices = services;
        controller.ControllerContext.HttpContext = httpContext;

        var tempDataProvider = services.GetRequiredService&lt;ITempDataProvider&gt;();
        controller.TempData = new TempDataDictionary(httpContext, tempDataProvider);

        // Act
        var result = await controller.CreateGroup(groupViewModel);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.False(controller.ModelState.IsValid);
    }

    [Fact]
    public async Task CreateGroup_Post_Valid_ReturnsRedirect()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var primaryManager = new User { Id = 1, UserName = &quot;Manager&quot;, Email = &quot;pm@example.com&quot; };
        var otherManager = new User { Id = 2, UserName = &quot;OtherManager&quot;, Email = &quot;om@example.com&quot; };
        var employee = new User { Id = 3, UserName = &quot;Employee&quot;, Email = &quot;emp@example.com&quot; };
        dbContext.Users.AddRange(primaryManager, otherManager, employee);
        await dbContext.SaveChangesAsync();

        var groupViewModel = new GroupViewModel
        {
            Name = &quot;NewGroup&quot;,
            Description = &quot;Test Description&quot;,
            SelectedManagerId = 1,
            SelectedUserIds = [3]
        };

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        var services = new ServiceCollection()
            .AddSingleton&lt;ITempDataProvider&gt;(new Mock&lt;ITempDataProvider&gt;().Object)
            .AddSingleton&lt;UserManager&lt;User&gt;&gt;(_mockUserManager.Object)
            .BuildServiceProvider();

        var httpContext = new DefaultHttpContext { RequestServices = services };
        controller.ControllerContext.HttpContext = httpContext;

        var tempDataProvider = services.GetRequiredService&lt;ITempDataProvider&gt;();
        controller.TempData = new TempDataDictionary(httpContext, tempDataProvider);

        var mockUrlHelper = new Mock&lt;IUrlHelper&gt;();
        controller.Url = mockUrlHelper.Object;

        var result = await controller.CreateGroup(groupViewModel);

        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;Groups&quot;, redirectResult.ActionName);
        Assert.Equal(1, groupViewModel.SelectedManagerId);
        Assert.Contains(3, groupViewModel.SelectedUserIds);
    }

    [Fact]
    public async Task CreateGroup_InvalidModelState_ReturnsViewWithEmployees()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        dbContext.Users.Add(new User { Id = 1, UserName = &quot;User1&quot;, Email = &quot;user1@example.com&quot; });
        dbContext.Users.Add(new User { Id = 2, UserName = &quot;User2&quot;, Email = &quot;user2@example.com&quot; });
        await dbContext.SaveChangesAsync();

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        var model = new GroupViewModel
        {
            Name = &quot;&quot;,
            Description = &quot;Some Description&quot;,
            SelectedManagerId = 1,
            SelectedUserIds = new List&lt;int&gt; { 2 }
        };

        controller.ModelState.AddModelError(&quot;Name&quot;, &quot;Name is required&quot;);

        // Act
        var result = await controller.CreateGroup(model);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.Equal(model, viewResult.Model);

        var employees = viewResult.ViewData[&quot;Employees&quot;] as List&lt;User&gt;;
        Assert.NotNull(employees);
        Assert.True(employees.Count &gt;= 2);
    }

    [Fact]
    public async Task DeleteGroup_RemovesGroupIfExists()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var group = new Group { Id = 20, Name = &quot;GroupToDelete&quot;, Description = &quot;Test Description&quot; };
        dbContext.Groups.Add(group);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.DeleteGroup(20);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.False(dbContext.Groups.Any(g =&gt; g.Id == 20));
    }

    [Fact]
    public async Task DeleteGroup_RedirectsIfGroupNotFound()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.DeleteGroup(999);

        // Assert
        Assert.IsType&lt;RedirectToActionResult&gt;(result);
    }

    [Fact]
    public async Task DeleteGroup_GroupAssignedToProject_ReturnsRedirectWithErrorMessage()
    {
        // Arrange
        var options = new DbContextOptionsBuilder&lt;ApplicationDbContext&gt;()
            .UseInMemoryDatabase(databaseName: Guid.NewGuid().ToString())
            .Options;

        using var dbContext = new ApplicationDbContext(options);

        var group = new Group { Id = 1, Name = &quot;Test Group&quot;, Description = &quot;Test&quot; };
        dbContext.Groups.Add(group);
        dbContext.GroupProjects.Add(new GroupProject { GroupId = 1, ProjectId = 1 });
        await dbContext.SaveChangesAsync();

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        controller.ControllerContext = new ControllerContext { HttpContext = new DefaultHttpContext() };
        controller.TempData = new TempDataDictionary(controller.ControllerContext.HttpContext,
            new Mock&lt;ITempDataProvider&gt;().Object);

        // Act
        var result = await controller.DeleteGroup(1);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;Groups&quot;, redirectResult.ActionName);
        Assert.Equal(&quot;This group is assigned to one or more projects and cannot be deleted.&quot;,
            controller.TempData[&quot;ErrorMessage&quot;]);
        var stillThere = await dbContext.Groups.FindAsync(1);
        Assert.NotNull(stillThere);
    }

    [Fact]
    public async Task DeleteGroup_DbUpdateException_SetsTempDataErrorMessage()
    {
        // Arrange
        var options = new DbContextOptionsBuilder&lt;ApplicationDbContext&gt;()
            .UseInMemoryDatabase(databaseName: Guid.NewGuid().ToString())
            .Options;

        var testContext = new TestApplicationDbContext(options);

        var group = new Group { Id = 1, Name = &quot;Test Group&quot;, Description = &quot;Test&quot;};
        testContext.Groups.Add(group);
        await testContext.SaveChangesAsync();

        testContext.ThrowOnSaveChanges = true;

        var controller = new AdminController(testContext, _mockUserManager.Object, _mockRoleManager.Object);
        controller.ControllerContext = new ControllerContext { HttpContext = new DefaultHttpContext() };
        controller.TempData = new TempDataDictionary(controller.ControllerContext.HttpContext,
            new Mock&lt;ITempDataProvider&gt;().Object);

        // Act
        var result = await controller.DeleteGroup(1);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;Groups&quot;, redirectResult.ActionName);
        Assert.Equal(&quot;Unable to delete this group because it is referenced elsewhere. Check project assignments&quot;,
            controller.TempData[&quot;ErrorMessage&quot;]);

        var existingGroup = await testContext.Groups.FindAsync(1);
        Assert.NotNull(existingGroup);
    }

    [Fact]
    public async Task AddUserToGroup_ReturnsNotFound_IfGroupOrUserNotFound()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act – group not found
        var result1 = await controller.AddUserToGroup(1, 1);
        Assert.IsType&lt;NotFoundResult&gt;(result1);

        dbContext.Groups.Add(new Group { Id = 50, Name = &quot;AddUserGroup&quot;, Description = &quot;Test Description&quot; });
        await dbContext.SaveChangesAsync();

        var result2 = await controller.AddUserToGroup(50, 99);
        Assert.IsType&lt;NotFoundResult&gt;(result2);
    }

    [Fact]
    public async Task AddUserToGroup_AddsUserIfNotAlreadyAdded()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var group = new Group { Id = 60, Name = &quot;UserGroup&quot;, Description = &quot;Test Description&quot; };
        var user = new User { Id = 10, UserName = &quot;GroupUser&quot;, Email = &quot;groupuser@example.com&quot; };
        dbContext.Groups.Add(group);
        dbContext.Users.Add(user);
        await dbContext.SaveChangesAsync();

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.AddUserToGroup(60, 10);

        // Assert
        var redirectResult = Assert.IsType&lt;PartialViewResult&gt;(result);
        Assert.Equal(&quot;_GroupUserAssignmentPartial&quot;, redirectResult.ViewName);

        // ✅ Check in `UserGroups`
        Assert.Contains(dbContext.UserGroups, ug =&gt; ug.GroupId == 60 &amp;&amp; ug.UserId == 10 &amp;&amp; ug.Role == &quot;Member&quot;);
    }

    [Fact]
    public async Task AddManagerToGroup_ReturnsNotFound_IfGroupOrUserNotFound()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act – group not found
        var result1 = await controller.AddManagerToGroup(1, 1, false);
        Assert.IsType&lt;NotFoundResult&gt;(result1);

        // Add group but not user
        dbContext.Groups.Add(new Group
        {
            Id = 70,
            Name = &quot;ManagerGroup&quot;,
            Description = &quot;Test description&quot;,
            Managers = new List&lt;GroupManager&gt;()
        });
        await dbContext.SaveChangesAsync();
        var result2 = await controller.AddManagerToGroup(70, 99, false);
        Assert.IsType&lt;NotFoundResult&gt;(result2);
    }

    [Fact]
    public async Task AddManagerToGroup_AddsManagerAndSetsPrimaryIfTrue()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var group = new Group
        {
            Id = 80,
            Name = &quot;ManagerGroup&quot;,
            Description = &quot;Test Description&quot;,
            Managers = new List&lt;GroupManager&gt;()
        };
        var user = new User
        {
            Id = 20,
            UserName = &quot;ManagerUser&quot;,
            Email = &quot;manager@example.com&quot;
        };
        var groupManager = new GroupManager
        {
            GroupId = 80,
            UserId = 20
        };
        dbContext.Groups.Add(group);
        dbContext.Users.Add(user);
        dbContext.GroupManagers.Add(groupManager);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.AddManagerToGroup(80, 20, true);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;GroupDetails&quot;, redirectResult.ActionName);
        Assert.Contains(dbContext.GroupManagers, gm =&gt; gm.GroupId == 80 &amp;&amp; gm.UserId == 20);
        Assert.Equal(20, group.ManagerId);
    }


    // ––– Tests for Project-related endpoints –––

    [Fact]
    public async Task Projects_ReturnsViewWithProjectsList()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        dbContext.Projects.Add(new Project { Id = 1, Name = &quot;Project1&quot;, Description = &quot;Test Description&quot; });
        dbContext.Projects.Add(new Project { Id = 2, Name = &quot;Project2&quot;, Description = &quot;Test Description&quot; });
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.Projects();

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var projects = Assert.IsAssignableFrom&lt;IEnumerable&lt;Project&gt;&gt;(viewResult.Model);
        Assert.Equal(2, projects.Count());
    }

    [Fact]
    public async Task CreateProject_Get_ReturnsViewWithProjectLeads()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        dbContext.Users.Add(new User { Id = 1, UserName = &quot;Lead1&quot;, Email = &quot;lead1@example.com&quot; });
        dbContext.Users.Add(new User { Id = 2, UserName = &quot;Lead2&quot;, Email = &quot;lead2@example.com&quot; });
        await dbContext.SaveChangesAsync();
        _mockUserManager.Setup(um =&gt; um.GetUserAsync(It.IsAny&lt;ClaimsPrincipal&gt;()))
            .ReturnsAsync(new User { Id = 3, UserName = &quot;Admin&quot;, Email = &quot;admin@example.com&quot; });

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        CreateProjectViewModel model = new CreateProjectViewModel
        {
            ProjectLeads = new List&lt;SelectListItem&gt;
            {
                new SelectListItem { Value = &quot;1&quot;, Text = &quot;Lead1&quot; },
                new SelectListItem { Value = &quot;2&quot;, Text = &quot;Lead2&quot; }
            }
        };

        // Act
        var result = await controller.CreateProject();

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.NotNull(model.ProjectLeads);
        Assert.Equal(2, model.ProjectLeads.Count);
    }

    [Fact]
    public async Task CreateProject_Post_InvalidModel_ReturnsView()
    {
        CreateProjectViewModel model = new CreateProjectViewModel();
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        _mockUserManager.Setup(um =&gt; um.GetUserAsync(It.IsAny&lt;ClaimsPrincipal&gt;()))
            .ReturnsAsync(new User { Id = 3, UserName = &quot;Admin&quot;, Email = &quot;admin@example.com&quot; });
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        controller.ModelState.AddModelError(&quot;Error&quot;, &quot;Invalid&quot;);
        var project = new Project { Id = 1, Name = &quot;InvalidProject&quot; };
        var users = await dbContext.Users.ToListAsync();

        model.ProjectLeads = users.Select(u =&gt; new SelectListItem
        {
            Value = u.Id.ToString(),
            Text = u.UserName
        }).ToList();

        CreateProjectViewModel viewModel = new CreateProjectViewModel
        {
            ProjectLeads = new List&lt;SelectListItem&gt;
            {
                new SelectListItem { Value = &quot;1&quot;, Text = &quot;Lead1&quot; },
                new SelectListItem { Value = &quot;2&quot;, Text = &quot;Lead2&quot; }
            }
        };
        // Act
        var result = await controller.CreateProject(viewModel);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.Equal(viewModel, viewResult.Model);
    }

    [Fact]
    public async Task CreateProject_Post_WithoutUserId_ReturnsViewWithError()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        _mockUserManager.Setup(um =&gt; um.GetUserAsync(It.IsAny&lt;ClaimsPrincipal&gt;()))
            .ReturnsAsync(new User { Id = 3, UserName = &quot;Admin&quot;, Email = &quot;admin@example.com&quot; });

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        _mockUserManager.Setup(um =&gt; um.GetUserId(It.IsAny&lt;ClaimsPrincipal&gt;())).Returns(string.Empty);
        var project = new Project { Id = 1, Name = &quot;ProjectNoUser&quot; };
        var users = await dbContext.Users.ToListAsync();

        CreateProjectViewModel model = new CreateProjectViewModel
        {
            ProjectLeads = users.Select(u =&gt; new SelectListItem
            {
                Value = u.Id.ToString(),
                Text = u.UserName
            }).ToList()
        };

        // Act
        var result = await controller.CreateProject(model);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.False(controller.ModelState.IsValid);
        Assert.Contains(&quot;&quot;, controller.ModelState.Keys);
    }

    [Fact]
    public async Task CreateProject_Post_Valid_ReturnsRedirect()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        this._mockUserManager.Setup(um =&gt; um.GetUserAsync(It.IsAny&lt;ClaimsPrincipal&gt;()))
            .ReturnsAsync(new User { Id = 3, UserName = &quot;Admin&quot;, Email = &quot;admin@example.com&quot; });

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        _mockUserManager.Setup(um =&gt; um.GetUserId(It.IsAny&lt;ClaimsPrincipal&gt;())).Returns(&quot;1&quot;);

        var claims = new List&lt;Claim&gt; { new Claim(ClaimTypes.NameIdentifier, &quot;1&quot;) };
        controller.ControllerContext.HttpContext = new DefaultHttpContext
        {
            User = new ClaimsPrincipal(new ClaimsIdentity(claims, &quot;TestAuth&quot;))
        };

        var services = new ServiceCollection()
            .AddSingleton&lt;ITempDataProvider&gt;(new Mock&lt;ITempDataProvider&gt;().Object)
            .BuildServiceProvider();

        controller.ControllerContext.HttpContext.RequestServices = services;
        controller.ControllerContext.HttpContext.Request.ContentType = &quot;application/x-www-form-urlencoded&quot;;
        controller.TempData = new TempDataDictionary(controller.ControllerContext.HttpContext,
            services.GetRequiredService&lt;ITempDataProvider&gt;());

        var mockUrlHelper = new Mock&lt;IUrlHelper&gt;();
        controller.Url = mockUrlHelper.Object;

        var users = await dbContext.Users.ToListAsync();

        CreateProjectViewModel model = new CreateProjectViewModel
        {
            Name = &quot;ValidProject&quot;,
            Description = &quot;Test Description&quot;,
            ProjectLeads = users.Select(u =&gt; new SelectListItem
            {
                Value = u.Id.ToString(),
                Text = u.UserName
            }).ToList()
        };

        // Act
        var result = await controller.CreateProject(model);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;Projects&quot;, redirectResult.ActionName);
        Assert.True(dbContext.Projects.Any(p =&gt; p.Name == &quot;ValidProject&quot;));
    }

    [Fact]
    public async Task CreateProject_Post_WithValidGroupData_CallsAssignGroupToProject()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();

        var validUser = new User { Id = 1, UserName = &quot;Lead1&quot;, Email = &quot;lead1@example.com&quot; };
        dbContext.Users.Add(validUser);
        await dbContext.SaveChangesAsync();

        dbContext.Groups.Add(new Group { Id = 1, ManagerId = 1, Description = &quot;Test&quot;, Name = &quot;TestGroup&quot; });
        await dbContext.SaveChangesAsync();

        _mockUserManager.Setup(um =&gt; um.GetUserAsync(It.IsAny&lt;ClaimsPrincipal&gt;()))
            .ReturnsAsync(new User { Id = 3, UserName = &quot;Admin&quot;, Email = &quot;admin@example.com&quot; });
        _mockUserManager.Setup(um =&gt; um.GetUserId(It.IsAny&lt;ClaimsPrincipal&gt;())).Returns(&quot;3&quot;);

        var mockController = new Mock&lt;AdminController&gt;(dbContext, _mockUserManager.Object, _mockRoleManager.Object)
        {
            CallBase = true
        };

        var claims = new List&lt;Claim&gt; { new Claim(ClaimTypes.NameIdentifier, &quot;3&quot;) };
        var httpContext = new DefaultHttpContext
        {
            User = new ClaimsPrincipal(new ClaimsIdentity(claims, &quot;TestAuth&quot;))
        };

        httpContext.Request.ContentType = &quot;application/x-www-form-urlencoded&quot;;

        var formData = new Dictionary&lt;string, Microsoft.Extensions.Primitives.StringValues&gt;
        {
            { &quot;GroupId&quot;, new Microsoft.Extensions.Primitives.StringValues(&quot;1&quot;) }
        };
        httpContext.Request.Form = new FormCollection(formData);

        mockController.Object.ControllerContext.HttpContext = httpContext;
        var services = new ServiceCollection()
            .AddSingleton&lt;ITempDataProvider&gt;(new Mock&lt;ITempDataProvider&gt;().Object)
            .BuildServiceProvider();
        mockController.Object.ControllerContext.HttpContext.RequestServices = services;
        mockController.Object.TempData = new TempDataDictionary(httpContext, services.GetRequiredService&lt;ITempDataProvider&gt;());
        var mockUrlHelper = new Mock&lt;IUrlHelper&gt;();
        mockController.Object.Url = mockUrlHelper.Object;

        var model = new CreateProjectViewModel
        {
            Name = &quot;ProjectWithGroups&quot;,
            Description = &quot;Test Description&quot;,
            ProjectLeadId = 1
        };

        // Act
        var result = await mockController.Object.CreateProject(model);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;Projects&quot;, redirectResult.ActionName);

        mockController.Verify(c =&gt; c.AssignGroupToProject(It.IsAny&lt;int&gt;(), 1), Times.Once);
    }

    [Fact]
    public async Task ProjectDetails_ReturnsNotFoundIfProjectDoesNotExist()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.ProjectDetails(9999);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task AssignGroupToProject_ReturnsNotFound_IfProjectOrGroupNotFound()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act: project not found
        var result1 = await controller.AssignGroupToProject(1, 1);
        Assert.IsType&lt;NotFoundResult&gt;(result1);

        // Add a project but not group
        dbContext.Projects.Add(new Project { Id = 1, Name = &quot;AssignProject&quot;, Description = &quot;Test Description&quot; });
        await dbContext.SaveChangesAsync();
        var result2 = await controller.AssignGroupToProject(1, 99);
        Assert.IsType&lt;NotFoundResult&gt;(result2);
    }

    [Fact]
    public async Task AssignGroupToProject_AddsGroupWhenNotAssigned()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var project = new Project { Id = 1, Name = &quot;AssignProject&quot;, ProjectGroups = new List&lt;GroupProject&gt;(), Description = &quot;Test Description&quot; };
        var group = new Group { Id = 10, Name = &quot;TestGroup&quot;, Description = &quot;Test Description&quot; };
        dbContext.Projects.Add(project);
        dbContext.Groups.Add(group);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.AssignGroupToProject(1, 10);

        // Assert
        var redirectResult = Assert.IsType&lt;PartialViewResult&gt;(result);
        Assert.Equal(&quot;_ProjectGroupAssignmentPartial&quot;, redirectResult.ViewName);
        Assert.Contains(project.ProjectGroups, pg =&gt; pg.GroupId == 10);
    }

    [Fact]
    public async Task AssignGroupToProject_DoesNotAddDuplicateGroup()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var groupProject = new GroupProject { ProjectId = 1, GroupId = 10 };
        var project = new Project { Id = 1, Name = &quot;AssignProject&quot;, ProjectGroups = new List&lt;GroupProject&gt; { groupProject }, Description = &quot;Test Description&quot; };
        var group = new Group { Id = 10, Name = &quot;TestGroup&quot;, Description = &quot;Test Description&quot; };
        dbContext.Projects.Add(project);
        dbContext.Groups.Add(group);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act – calling assign again should not duplicate the group assignment
        var result = await controller.AssignGroupToProject(1, 10);

        // Assert
        var redirectResult = Assert.IsType&lt;PartialViewResult&gt;(result);
        Assert.Equal(1, project.ProjectGroups.Count(pg =&gt; pg.GroupId == 10));
    }

    [Fact]
    public async Task RemoveGroupFromProject_ReturnsNotFound_IfProjectNotFound()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.RemoveGroupFromProject(1, 10);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task RemoveGroupFromProject_RemovesGroupIfExists()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var groupProject = new GroupProject { ProjectId = 1, GroupId = 10 };
        var project = new Project { Id = 1, Name = &quot;RemoveProject&quot;, ProjectGroups = new List&lt;GroupProject&gt; { groupProject }, Description = &quot;Test Description&quot; };
        dbContext.Projects.Add(project);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.RemoveGroupFromProject(1, 10);

        // Assert
        var redirectResult = Assert.IsType&lt;PartialViewResult&gt;(result);
        Assert.Equal(&quot;_ProjectGroupAssignmentPartial&quot;, redirectResult.ViewName);
        Assert.DoesNotContain(project.ProjectGroups, pg =&gt; pg.GroupId == 10);
    }

    [Fact]
    public async Task EditProject_Get_ReturnsViewIfProjectExists()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var project = new Project { Id = 50, Name = &quot;EditProject&quot;, Description = &quot;Test Description&quot; };
        dbContext.Projects.Add(project);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.EditProject(50);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var modelProject = Assert.IsType&lt;Project&gt;(viewResult.Model);
        Assert.Equal(&quot;EditProject&quot;, modelProject.Name);
        Assert.NotNull(viewResult.ViewData[&quot;ProjectLeads&quot;]);
    }

    [Fact]
    public async Task EditProject_Get_ReturnsNotFoundIfProjectDoesNotExist()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.EditProject(9999);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task EditProject_Post_BadRequestIfIdMismatch()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var project = new Project { Id = 10, Name = &quot;Mismatch&quot; };
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.EditProject(5, project);

        // Assert
        Assert.IsType&lt;BadRequestResult&gt;(result);
    }

    [Fact]
    public async Task EditProject_Post_MissingUserId_ReturnsViewWithError()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var project = new Project { Id = 20, Name = &quot;MissingUser&quot;, Description = &quot;Test Description&quot; };
        dbContext.Projects.Add(project);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        _mockUserManager.Setup(um =&gt; um.GetUserId(It.IsAny&lt;ClaimsPrincipal&gt;())).Returns(string.Empty);

        // Act
        var result = await controller.EditProject(20, project);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.False(controller.ModelState.IsValid);
    }

    [Fact]
    public async Task EditProject_Post_Valid_ReturnsRedirect()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var project = new Project { Id = 30, Name = &quot;ValidEdit&quot;, Description = &quot;Test Description&quot; };
        dbContext.Projects.Add(project);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        _mockUserManager.Setup(um =&gt; um.GetUserId(It.IsAny&lt;ClaimsPrincipal&gt;())).Returns(&quot;1&quot;);
        var claims = new List&lt;Claim&gt; { new Claim(ClaimTypes.NameIdentifier, &quot;1&quot;) };
        controller.ControllerContext.HttpContext = new DefaultHttpContext { User = new ClaimsPrincipal(new ClaimsIdentity(claims, &quot;TestAuth&quot;)) };

        // Act
        var result = await controller.EditProject(30, project);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;ProjectDetails&quot;, redirectResult.ActionName);
    }

    public class ConcurrencyDbContext : ApplicationDbContext
    {
        public ConcurrencyDbContext(DbContextOptions&lt;ApplicationDbContext&gt; options)
            : base(options) { }

        public override Task&lt;int&gt; SaveChangesAsync(CancellationToken cancellationToken = default)
        {
            throw new DbUpdateConcurrencyException();
        }
    }

    [Fact]
    public async Task EditProject_Post_ConcurrencyException_ReturnsNotFound()
    {
        // Arrange
        var options = new DbContextOptionsBuilder&lt;ApplicationDbContext&gt;()
            .UseInMemoryDatabase(&quot;ConcurrencyTest&quot;)
            .Options;
        var dbContext = new ConcurrencyDbContext(options);
        var project = new Project { Id = 40, Name = &quot;Concurrency&quot; };
        // Do not add the project so that the check for existence fails.
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        _mockUserManager.Setup(um =&gt; um.GetUserId(It.IsAny&lt;ClaimsPrincipal&gt;())).Returns(&quot;1&quot;);
        var claims = new List&lt;Claim&gt; { new Claim(ClaimTypes.NameIdentifier, &quot;1&quot;) };
        controller.ControllerContext.HttpContext = new DefaultHttpContext { User = new ClaimsPrincipal(new ClaimsIdentity(claims, &quot;TestAuth&quot;)) };

        // Act
        var result = await controller.EditProject(40, project);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task DeleteProject_RemovesProjectIfExists()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var project = new Project { Id = 55, Name = &quot;ToDelete&quot;, Description = &quot;Test Description&quot; };
        dbContext.Projects.Add(project);
        await dbContext.SaveChangesAsync();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.DeleteProject(55);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.False(dbContext.Projects.Any(p =&gt; p.Id == 55));
    }

    [Fact]
    public async Task DeleteProject_RedirectsIfProjectNotFound()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.DeleteProject(999);

        // Assert
        Assert.IsType&lt;RedirectToActionResult&gt;(result);
    }

    [Fact]
    public async Task Users_ReturnsEmptyViewIfNoUsers()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.Users();

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        var model = Assert.IsAssignableFrom&lt;IEnumerable&lt;User&gt;&gt;(viewResult.Model);
        Assert.Empty(model);
    }

    //[Fact]
    //public async Task CreateProject_ReturnsViewWithErrors_IfModelStateInvalid()
    //{
    //    // Arrange
    //    var dbContext = TestHelper.GetDbContext();
    //    var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

    //    controller.ModelState.AddModelError(&quot;Name&quot;, &quot;Required&quot;);

    //    var users = await dbContext.Users.ToListAsync();

    //    CreateProjectViewModel model = new CreateProjectViewModel
    //    {
    //        ProjectLeads = users.Select(u =&gt; new SelectListItem
    //        {
    //            Value = u.Id.ToString(),
    //            Text = u.UserName
    //        }).ToList()
    //    };

    //    // Act
    //    var result = await controller.CreateProject(model);

    //    // Assert
    //    var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
    //    Assert.False(controller.ModelState.IsValid);
    //}

    [Fact]
    public async Task UserAdd_CreatesUserAndRedirects_WhenSuccessful()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        var model = new UserViewModel { UserName = &quot;NewUser&quot;, Email = &quot;new@example.com&quot;, Password = &quot;Test@123&quot;, ConfirmPassword = &quot;Test@123&quot; };

        _mockUserManager.Setup(um =&gt; um.CreateAsync(It.IsAny&lt;User&gt;(), model.Password))
            .ReturnsAsync(IdentityResult.Success);
        _mockUserManager.Setup(um =&gt; um.AddToRoleAsync(It.IsAny&lt;User&gt;(), &quot;Employee&quot;))
            .ReturnsAsync(IdentityResult.Success);

        // Act
        var result = await controller.UserAdd(model);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;Users&quot;, redirectResult.ActionName);
    }

    [Fact]
    public async Task UserAdd_ReturnsViewWithErrors_WhenUserCreationFails()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        var model = new UserViewModel { UserName = &quot;NewUser&quot;, Email = &quot;new@example.com&quot;, Password = &quot;Test@123&quot;, ConfirmPassword = &quot;Test@123&quot; };

        var identityErrors = new IdentityError[] { new IdentityError { Code = &quot;Error1&quot;, Description = &quot;User creation failed&quot; } };
        _mockUserManager.Setup(um =&gt; um.CreateAsync(It.IsAny&lt;User&gt;(), model.Password))
            .ReturnsAsync(IdentityResult.Failed(identityErrors));

        // Act
        var result = await controller.UserAdd(model);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.False(controller.ModelState.IsValid);
        Assert.Contains(&quot;User creation failed&quot;, controller.ModelState[string.Empty].Errors.First().ErrorMessage);
    }

    [Fact]
    public async Task UserAdd_ReturnsViewWithErrors_WhenRoleAssignmentFails()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        var model = new UserViewModel { UserName = &quot;NewUser&quot;, Email = &quot;new@example.com&quot;, Password = &quot;Test@123&quot;, ConfirmPassword = &quot;Test@123&quot; };

        _mockUserManager.Setup(um =&gt; um.CreateAsync(It.IsAny&lt;User&gt;(), model.Password))
            .ReturnsAsync(IdentityResult.Success);

        var identityErrors = new IdentityError[] { new IdentityError { Code = &quot;Error2&quot;, Description = &quot;Role assignment failed&quot; } };
        _mockUserManager.Setup(um =&gt; um.AddToRoleAsync(It.IsAny&lt;User&gt;(), &quot;Employee&quot;))
            .ReturnsAsync(IdentityResult.Failed(identityErrors));

        // Act
        var result = await controller.UserAdd(model);

        // Assert
        var viewResult = Assert.IsType&lt;ViewResult&gt;(result);
        Assert.False(controller.ModelState.IsValid);
        Assert.Contains(&quot;Role assignment failed&quot;, controller.ModelState[string.Empty].Errors.First().ErrorMessage);
    }

    [Fact]
    public async Task UserEdit_UpdatesUserAndRedirects_WhenSuccessful()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        var user = new User { Id = 1, UserName = &quot;OldUser&quot;, Email = &quot;old@example.com&quot; };

        _mockUserManager.Setup(um =&gt; um.FindByIdAsync(user.Id.ToString()))
            .ReturnsAsync(user);
        _mockUserManager.Setup(um =&gt; um.UpdateAsync(It.IsAny&lt;User&gt;()))
            .ReturnsAsync(IdentityResult.Success);
        _mockUserManager.Setup(um =&gt; um.GetRolesAsync(user))
            .ReturnsAsync(new List&lt;string&gt; { &quot;Employee&quot; });
        _mockUserManager.Setup(um =&gt; um.RemoveFromRolesAsync(user, It.IsAny&lt;IEnumerable&lt;string&gt;&gt;()))
            .ReturnsAsync(IdentityResult.Success);
        _mockUserManager.Setup(um =&gt; um.AddToRoleAsync(user, &quot;Admin&quot;))
            .ReturnsAsync(IdentityResult.Success);

        // Act
        var result = await controller.UserEdit(user.Id.ToString(), &quot;UpdatedUser&quot;, &quot;updated@example.com&quot;, &quot;Admin&quot;);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;Users&quot;, redirectResult.ActionName);
        Assert.Equal(&quot;UpdatedUser&quot;, user.UserName);
        Assert.Equal(&quot;updated@example.com&quot;, user.Email);
    }

    [Fact]
    public async Task UserEdit_ReturnsNotFound_WhenUserDoesNotExist()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        _mockUserManager.Setup(um =&gt; um.FindByIdAsync(&quot;999&quot;))
            .ReturnsAsync((User)null);

        // Act
        var result = await controller.UserEdit(&quot;999&quot;, &quot;UpdatedUser&quot;, &quot;updated@example.com&quot;, &quot;Admin&quot;);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task UserEdit_RemovesExistingRolesBeforeAddingNewRole()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        var user = new User { Id = 1, UserName = &quot;TestUser&quot;, Email = &quot;test@example.com&quot; };

        _mockUserManager.Setup(um =&gt; um.FindByIdAsync(user.Id.ToString()))
            .ReturnsAsync(user);
        _mockUserManager.Setup(um =&gt; um.UpdateAsync(user))
            .ReturnsAsync(IdentityResult.Success);
        _mockUserManager.Setup(um =&gt; um.GetRolesAsync(user))
            .ReturnsAsync(new List&lt;string&gt; { &quot;Manager&quot;, &quot;Employee&quot; });
        _mockUserManager.Setup(um =&gt; um.RemoveFromRolesAsync(user, It.IsAny&lt;IEnumerable&lt;string&gt;&gt;()))
            .ReturnsAsync(IdentityResult.Success);
        _mockUserManager.Setup(um =&gt; um.AddToRoleAsync(user, &quot;Admin&quot;))
            .ReturnsAsync(IdentityResult.Success);

        // Act
        var result = await controller.UserEdit(user.Id.ToString(), &quot;UpdatedUser&quot;, &quot;updated@example.com&quot;, &quot;Admin&quot;);

        // Assert
        var redirectResult = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;Users&quot;, redirectResult.ActionName);

        _mockUserManager.Verify(um =&gt; um.RemoveFromRolesAsync(user, It.IsAny&lt;IEnumerable&lt;string&gt;&gt;()), Times.Once);
        _mockUserManager.Verify(um =&gt; um.AddToRoleAsync(user, &quot;Admin&quot;), Times.Once);
    }

    [Fact]
    public async Task ChangeManager_GroupNotFound_ReturnsNotFound()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        dbContext.Users.Add(new User { Id = 1, UserName = &quot;Manager&quot;, Email = &quot;manager@example.com&quot; });
        await dbContext.SaveChangesAsync();

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.ChangeManager(1, 1);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task ChangeManager_NewManagerNotFound_ReturnsNotFound()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        dbContext.Groups.Add(new Group { Id = 1, Name = &quot;Group 1&quot;, Description = &quot;Test&quot; });
        await dbContext.SaveChangesAsync();

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);

        // Act
        var result = await controller.ChangeManager(1, 99);

        // Assert
        Assert.IsType&lt;NotFoundResult&gt;(result);
    }

    [Fact]
    public async Task ChangeManager_NewManagerEntryCreated_NoPreviousManager_ReturnsRedirect()
    {
        // Arrange
        var dbContext = TestHelper.GetDbContext();
        var group = new Group { Id = 1, Name = &quot;Group 1&quot;, ManagerId = null, Description = &quot;Test&quot; };
        dbContext.Groups.Add(group);
        var newManager = new User { Id = 2, UserName = &quot;NewManager&quot;, Email = &quot;newmanager@example.com&quot; };
        dbContext.Users.Add(newManager);
        await dbContext.SaveChangesAsync();

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        controller.ControllerContext = new ControllerContext
        {
            HttpContext = new DefaultHttpContext()
        };

        // Act
        var result = await controller.ChangeManager(1, 2);

        // Assert
        var redirect = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;GroupDetails&quot;, redirect.ActionName);

        var updatedGroup = await dbContext.Groups.FindAsync(1);
        Assert.Equal(2, updatedGroup.ManagerId);

        var userGroup = await dbContext.UserGroups.FirstOrDefaultAsync(ug =&gt; ug.GroupId == 1 &amp;&amp; ug.UserId == 2);
        Assert.NotNull(userGroup);
        Assert.Equal(&quot;Manager&quot;, userGroup.Role);
    }

    [Fact]
    public async Task ChangeManager_NewManagerEntryCreated_WithPreviousManager_UpdatesPreviousManagerEntry()
    {
        // Arrange:
        var dbContext = TestHelper.GetDbContext();
        var previousManager = new User { Id = 1, UserName = &quot;OldManager&quot;, Email = &quot;oldmanager@example.com&quot; };
        var newManager = new User { Id = 2, UserName = &quot;NewManager&quot;, Email = &quot;newmanager@example.com&quot; };
        dbContext.Users.Add(previousManager);
        dbContext.Users.Add(newManager);
        var group = new Group { Id = 1, Name = &quot;Group 1&quot;, ManagerId = 1, Description = &quot;Test&quot; };
        dbContext.Groups.Add(group);
        dbContext.UserGroups.Add(new UserGroup { GroupId = 1, UserId = 1, Role = &quot;Manager&quot; });
        await dbContext.SaveChangesAsync();

        var controller = new AdminController(dbContext, _mockUserManager.Object, _mockRoleManager.Object);
        controller.ControllerContext = new ControllerContext
        {
            HttpContext = new DefaultHttpContext()
        };

        // Act
        var result = await controller.ChangeManager(1, 2);

        // Assert
        var redirect = Assert.IsType&lt;RedirectToActionResult&gt;(result);
        Assert.Equal(&quot;GroupDetails&quot;, redirect.ActionName);

        var updatedGroup = await dbContext.Groups.FindAsync(1);
        Assert.Equal(2, updatedGroup.ManagerId);

        var newManagerEntry = await dbContext.UserGroups.FirstOrDefaultAsync(ug =&gt; ug.GroupId == 1 &amp;&amp; ug.UserId == 2);
        Assert.NotNull(newManagerEntry);
        Assert.Equal(&quot;Manager&quot;, newManagerEntry.Role);

        var previousManagerEntry = await dbContext.UserGroups.FirstOrDefaultAsync(ug =&gt; ug.GroupId == 1 &amp;&amp; ug.UserId == 1);
        Assert.NotNull(previousManagerEntry);
        Assert.Equal(&quot;Member&quot;, previousManagerEntry.Role);
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[25,5,25,34,1],[26,5,26,6,1],[27,9,27,49,1],[28,9,28,49,1],[29,9,29,48,1],[31,9,35,25,1],[36,9,36,67,1],[38,9,39,80,1],[40,5,40,6,1],[43,5,43,6,1],[44,9,44,58,1],[45,9,46,61,1],[47,5,47,6,1],[50,5,50,6,1],[51,9,51,71,1],[52,9,53,37,1],[54,5,54,6,1],[59,5,59,6,1],[61,9,61,123,1],[63,9,63,81,1],[65,9,71,11,1],[74,9,74,58,1],[77,9,77,60,1],[78,9,78,51,1],[79,5,79,6,1],[83,5,83,6,1],[85,9,85,51,1],[86,9,86,99,1],[87,9,87,99,1],[88,9,88,44,1],[89,9,89,107,1],[92,9,92,47,1],[95,9,95,60,1],[96,9,96,82,1],[97,9,97,40,1],[98,5,98,6,1],[102,5,102,6,1],[103,9,103,108,1],[105,9,105,55,1],[107,9,107,47,1],[108,5,108,6,1],[112,5,112,6,1],[113,9,113,108,1],[114,9,114,89,1],[115,9,115,47,1],[116,9,116,45,1],[118,9,118,95,1],[119,9,119,105,1],[121,9,125,26,1],[127,9,127,68,1],[129,9,129,60,1],[130,9,130,59,1],[131,9,131,41,1],[132,9,132,53,1],[134,9,134,50,1],[135,9,135,60,1],[136,9,136,63,1],[137,5,137,6,1],[141,5,141,6,1],[142,9,142,108,1],[144,9,144,43,1],[146,9,146,43,1],[147,5,147,6,1],[151,5,151,6,1],[153,9,153,51,1],[154,9,154,96,1],[155,9,155,35,1],[156,9,156,44,1],[157,9,157,107,1],[160,9,160,55,1],[163,9,163,60,1],[164,9,164,63,1],[165,9,165,56,1],[166,5,166,6,1],[170,5,170,6,1],[172,9,172,51,1],[173,9,173,107,1],[176,9,176,56,1],[179,9,179,47,1],[180,5,180,6,1],[184,5,184,6,1],[186,9,186,51,1],[187,9,187,97,1],[188,9,188,35,1],[189,9,189,44,1],[190,9,190,107,1],[193,9,193,55,1],[196,9,196,60,1],[197,9,197,78,1],[198,9,198,61,1],[199,5,199,6,1],[203,5,203,6,1],[205,9,205,51,1],[206,9,206,107,1],[209,9,209,55,1],[212,9,212,47,1],[213,5,213,6,1],[217,5,217,6,1],[219,9,219,51,1],[220,9,220,103,1],[221,9,221,35,1],[222,9,222,44,1],[223,9,223,107,1],[226,9,226,60,1],[229,9,229,76,1],[230,9,230,61,1],[231,5,231,6,1],[237,5,237,6,1],[239,9,239,51,1],[240,9,240,103,1],[241,9,241,103,1],[242,9,242,44,1],[243,9,243,107,1],[246,9,246,48,1],[249,9,249,60,1],[250,9,250,84,1],[251,9,251,41,1],[252,5,252,6,1],[256,5,256,6,1],[258,9,258,51,1],[259,9,259,107,1],[260,9,260,43,1],[261,9,261,33,1],[263,9,264,33,1],[265,9,266,34,1],[267,9,268,34,1],[269,9,270,33,1],[272,9,272,107,1],[274,9,274,52,1],[275,9,278,37,1],[279,9,279,48,1],[281,9,281,64,1],[282,9,282,117,1],[285,9,285,47,1],[288,9,288,60,1],[289,9,289,58,1],[290,9,290,72,1],[291,9,291,34,1],[292,9,292,66,1],[293,5,293,6,1],[297,5,297,6,1],[299,9,299,51,1],[300,9,300,107,1],[303,9,303,57,1],[306,9,306,47,1],[307,5,307,6,1],[311,5,311,6,1],[313,9,313,51,1],[314,9,319,11,1],[320,9,320,37,1],[322,9,322,104,1],[323,9,323,107,1],[324,9,324,61,1],[326,9,326,96,1],[327,9,327,95,1],[329,9,329,44,1],[331,9,331,107,1],[334,9,334,56,1],[337,9,337,60,1],[338,9,338,65,1],[339,9,339,55,1],[341,9,341,59,1],[342,9,342,79,1],[343,9,343,36,1],[344,9,344,43,1],[346,9,346,43,1],[346,43,346,81,1],[346,81,346,83,1],[347,9,347,43,1],[347,43,347,80,1],[347,80,347,82,1],[348,5,348,6,1],[352,5,352,6,1],[354,9,354,51,1],[356,9,362,11,1],[363,9,363,107,1],[365,9,368,37,1],[370,9,370,52,1],[371,9,371,48,1],[372,9,372,64,1],[374,9,374,81,1],[375,9,375,85,1],[378,9,378,67,1],[381,9,381,60,1],[382,9,382,53,1],[383,5,383,6,1],[387,5,387,6,1],[389,9,389,51,1],[390,9,390,98,1],[391,9,391,101,1],[392,9,392,94,1],[393,9,393,74,1],[394,9,394,44,1],[396,9,402,11,1],[404,9,404,107,1],[406,9,409,37,1],[411,9,411,81,1],[412,9,412,64,1],[414,9,414,81,1],[415,9,415,85,1],[417,9,417,52,1],[418,9,418,47,1],[420,9,420,67,1],[422,9,422,76,1],[423,9,423,59,1],[424,9,424,59,1],[425,9,425,60,1],[426,5,426,6,1],[430,5,430,6,1],[432,9,432,51,1],[433,9,433,99,1],[434,9,434,99,1],[435,9,435,44,1],[437,9,437,107,1],[439,9,445,11,1],[447,9,447,73,1],[450,9,450,58,1],[453,9,453,60,1],[454,9,454,47,1],[456,9,456,72,1],[457,9,457,35,1],[458,9,458,43,1],[459,5,459,6,1],[463,5,463,6,1],[465,9,465,51,1],[466,9,466,101,1],[467,9,467,37,1],[468,9,468,44,1],[469,9,469,107,1],[472,9,472,55,1],[475,9,475,76,1],[476,9,476,61,1],[477,5,477,6,1],[481,5,481,6,1],[483,9,483,51,1],[484,9,484,107,1],[487,9,487,56,1],[490,9,490,55,1],[491,5,491,6,1],[495,5,495,6,1],[497,9,499,22,1],[501,9,501,65,1],[503,9,503,85,1],[504,9,504,37,1],[505,9,505,86,1],[506,9,506,44,1],[508,9,508,107,1],[509,9,509,105,1],[510,9,511,51,1],[514,9,514,54,1],[517,9,517,76,1],[518,9,518,59,1],[519,9,520,50,1],[521,9,521,62,1],[522,9,522,36,1],[523,5,523,6,1],[527,5,527,6,1],[529,9,531,22,1],[533,9,533,65,1],[535,9,535,84,1],[536,9,536,39,1],[537,9,537,46,1],[539,9,539,47,1],[541,9,541,109,1],[542,9,542,105,1],[543,9,544,51,1],[547,9,547,54,1],[550,9,550,76,1],[551,9,551,59,1],[552,9,553,50,1],[555,9,555,67,1],[556,9,556,39,1],[557,5,557,6,1],[561,5,561,6,1],[563,9,563,51,1],[564,9,564,107,1],[567,9,567,61,1],[568,9,568,48,1],[570,9,570,110,1],[571,9,571,44,1],[573,9,573,63,1],[574,9,574,48,1],[575,5,575,6,1],[579,5,579,6,1],[581,9,581,51,1],[582,9,582,97,1],[583,9,583,98,1],[584,9,584,37,1],[585,9,585,35,1],[586,9,586,44,1],[588,9,588,107,1],[591,9,591,62,1],[594,9,594,71,1],[595,9,595,78,1],[598,9,598,53,1],[598,53,598,111,1],[598,111,598,113,1],[599,5,599,6,1],[603,5,603,6,1],[605,9,605,51,1],[606,9,606,107,1],[609,9,609,71,1],[610,9,610,48,1],[613,9,619,12,1],[620,9,620,44,1],[621,9,621,73,1],[622,9,622,48,1],[623,5,623,6,1],[627,5,627,6,1],[629,9,629,51,1],[630,9,636,11,1],[637,9,642,11,1],[643,9,647,11,1],[648,9,648,37,1],[649,9,649,35,1],[650,9,650,51,1],[651,9,651,44,1],[652,9,652,107,1],[655,9,655,71,1],[658,9,658,76,1],[659,9,659,65,1],[660,9,660,56,1],[660,56,660,91,1],[660,91,660,93,1],[661,9,661,43,1],[662,5,662,6,1],[669,5,669,6,1],[671,9,671,51,1],[672,9,672,109,1],[673,9,673,109,1],[674,9,674,44,1],[675,9,675,107,1],[678,9,678,50,1],[681,9,681,60,1],[682,9,682,88,1],[683,9,683,43,1],[684,5,684,6,1],[688,5,688,6,1],[690,9,690,51,1],[691,9,691,99,1],[692,9,692,99,1],[693,9,693,44,1],[694,9,695,97,1],[697,9,697,107,1],[699,9,706,11,1],[709,9,709,55,1],[712,9,712,60,1],[713,9,713,44,1],[714,9,714,51,1],[715,5,715,6,1],[719,5,719,6,1],[720,9,720,69,1],[722,9,722,51,1],[723,9,724,97,1],[725,9,725,107,1],[726,9,726,65,1],[727,9,727,71,1],[728,9,728,57,1],[730,9,730,48,1],[730,48,734,10,0],[734,10,734,21,1],[736,9,743,11,1],[745,9,745,64,1],[748,9,748,60,1],[749,9,749,51,1],[750,5,750,6,1],[754,5,754,6,1],[756,9,756,51,1],[757,9,758,97,1],[760,9,760,107,1],[761,9,761,103,1],[762,9,762,70,1],[763,9,763,57,1],[765,9,767,46,1],[767,46,771,14,0],[771,14,772,11,1],[775,9,775,60,1],[778,9,778,60,1],[779,9,779,53,1],[780,9,780,57,1],[781,5,781,6,1],[785,5,785,6,1],[787,9,787,51,1],[788,9,789,97,1],[791,9,791,107,1],[793,9,793,94,1],[795,9,795,84,1],[796,9,799,11,1],[801,9,803,37,1],[805,9,805,77,1],[806,9,806,108,1],[807,9,808,63,1],[810,9,810,52,1],[811,9,811,47,1],[813,9,813,57,1],[815,9,819,46,1],[819,46,823,14,0],[823,14,824,11,1],[827,9,827,60,1],[830,9,830,76,1],[831,9,831,61,1],[832,9,832,76,1],[833,5,833,6,1],[837,5,837,6,1],[839,9,839,51,1],[841,9,841,94,1],[842,9,842,40,1],[843,9,843,44,1],[845,9,845,109,1],[846,9,846,44,1],[848,9,849,97,1],[850,9,850,94,1],[852,9,855,11,1],[857,9,857,84,1],[858,9,861,11,1],[863,9,863,79,1],[865,9,868,11,1],[869,9,869,65,1],[871,9,871,75,1],[872,9,874,37,1],[875,9,875,88,1],[876,9,876,128,1],[877,9,877,52,1],[878,9,878,58,1],[880,9,885,11,1],[888,9,888,71,1],[891,9,891,76,1],[892,9,892,61,1],[894,9,894,92,1],[895,5,895,6,1],[899,5,899,6,1],[901,9,901,51,1],[902,9,902,107,1],[905,9,905,60,1],[908,9,908,47,1],[909,5,909,6,1],[913,5,913,6,1],[915,9,915,51,1],[916,9,916,107,1],[919,9,919,67,1],[920,9,920,48,1],[923,9,923,114,1],[924,9,924,44,1],[925,9,925,68,1],[926,9,926,48,1],[927,5,927,6,1],[931,5,931,6,1],[933,9,933,51,1],[934,9,934,146,1],[935,9,935,97,1],[936,9,936,41,1],[937,9,937,37,1],[938,9,938,44,1],[939,9,939,107,1],[942,9,942,67,1],[945,9,945,71,1],[946,9,946,81,1],[947,9,947,54,1],[947,54,947,70,1],[947,70,947,72,1],[948,5,948,6,1],[952,5,952,6,1],[954,9,954,51,1],[955,9,955,77,1],[956,9,956,161,1],[957,9,957,97,1],[958,9,958,41,1],[959,9,959,37,1],[960,9,960,44,1],[961,9,961,107,1],[964,9,964,67,1],[967,9,967,71,1],[968,9,968,59,1],[968,59,968,75,1],[968,75,968,78,1],[969,5,969,6,1],[973,5,973,6,1],[975,9,975,51,1],[976,9,976,107,1],[979,9,979,69,1],[982,9,982,47,1],[983,5,983,6,1],[987,5,987,6,1],[989,9,989,51,1],[990,9,990,77,1],[991,9,991,161,1],[992,9,992,41,1],[993,9,993,44,1],[994,9,994,107,1],[997,9,997,69,1],[1000,9,1000,71,1],[1001,9,1001,81,1],[1002,9,1002,60,1],[1002,60,1002,76,0],[1002,76,1002,78,1],[1003,5,1003,6,1],[1007,5,1007,6,1],[1009,9,1009,51,1],[1010,9,1010,103,1],[1011,9,1011,41,1],[1012,9,1012,44,1],[1013,9,1013,107,1],[1016,9,1016,55,1],[1019,9,1019,60,1],[1020,9,1020,69,1],[1021,9,1021,56,1],[1022,9,1022,61,1],[1023,5,1023,6,1],[1027,5,1027,6,1],[1029,9,1029,51,1],[1030,9,1030,107,1],[1033,9,1033,57,1],[1036,9,1036,47,1],[1037,5,1037,6,1],[1041,5,1041,6,1],[1043,9,1043,51,1],[1044,9,1044,66,1],[1045,9,1045,107,1],[1048,9,1048,63,1],[1051,9,1051,49,1],[1052,5,1052,6,1],[1056,5,1056,6,1],[1058,9,1058,51,1],[1059,9,1059,103,1],[1060,9,1060,41,1],[1061,9,1061,44,1],[1062,9,1062,107,1],[1063,9,1063,103,1],[1066,9,1066,64,1],[1069,9,1069,60,1],[1070,9,1070,53,1],[1071,5,1071,6,1],[1075,5,1075,6,1],[1077,9,1077,51,1],[1078,9,1078,101,1],[1079,9,1079,41,1],[1080,9,1080,44,1],[1081,9,1081,107,1],[1082,9,1082,94,1],[1083,9,1083,84,1],[1084,9,1084,146,1],[1087,9,1087,64,1],[1090,9,1090,76,1],[1091,9,1091,67,1],[1092,5,1092,6,1],[1097,15,1097,28,1],[1097,29,1097,30,1],[1097,31,1097,32,1],[1100,9,1100,10,1],[1101,13,1101,54,1],[1107,5,1107,6,1],[1109,9,1111,22,1],[1112,9,1112,59,1],[1113,9,1113,69,1],[1115,9,1115,107,1],[1116,9,1116,94,1],[1117,9,1117,84,1],[1118,9,1118,146,1],[1121,9,1121,64,1],[1124,9,1124,47,1],[1125,5,1125,6,1],[1129,5,1129,6,1],[1131,9,1131,51,1],[1132,9,1132,100,1],[1133,9,1133,41,1],[1134,9,1134,44,1],[1135,9,1135,107,1],[1138,9,1138,57,1],[1141,9,1141,76,1],[1142,9,1142,63,1],[1143,5,1143,6,1],[1147,5,1147,6,1],[1149,9,1149,51,1],[1150,9,1150,107,1],[1153,9,1153,58,1],[1156,9,1156,55,1],[1157,5,1157,6,1],[1161,5,1161,6,1],[1163,9,1163,51,1],[1164,9,1164,107,1],[1167,9,1167,47,1],[1170,9,1170,60,1],[1171,9,1171,82,1],[1172,9,1172,29,1],[1173,5,1173,6,1],[1205,5,1205,6,1],[1207,9,1207,51,1],[1208,9,1208,107,1],[1209,9,1209,144,1],[1211,9,1212,51,1],[1213,9,1214,51,1],[1217,9,1217,54,1],[1220,9,1220,76,1],[1221,9,1221,58,1],[1222,5,1222,6,1],[1226,5,1226,6,1],[1228,9,1228,51,1],[1229,9,1229,107,1],[1230,9,1230,144,1],[1232,9,1232,130,1],[1233,9,1234,66,1],[1237,9,1237,54,1],[1240,9,1240,60,1],[1241,9,1241,53,1],[1242,9,1242,114,1],[1243,5,1243,6,1],[1247,5,1247,6,1],[1249,9,1249,51,1],[1250,9,1250,107,1],[1251,9,1251,144,1],[1253,9,1254,51,1],[1256,9,1256,132,1],[1257,9,1258,66,1],[1261,9,1261,54,1],[1264,9,1264,60,1],[1265,9,1265,53,1],[1266,9,1266,116,1],[1267,5,1267,6,1],[1271,5,1271,6,1],[1273,9,1273,51,1],[1274,9,1274,107,1],[1275,9,1275,89,1],[1277,9,1278,33,1],[1279,9,1280,51,1],[1281,9,1282,60,1],[1283,9,1284,51,1],[1285,9,1286,51,1],[1289,9,1289,115,1],[1292,9,1292,76,1],[1293,9,1293,58,1],[1294,9,1294,52,1],[1295,9,1295,57,1],[1296,5,1296,6,1],[1300,5,1300,6,1],[1302,9,1302,51,1],[1303,9,1303,107,1],[1305,9,1306,39,1],[1309,9,1309,102,1],[1312,9,1312,47,1],[1313,5,1313,6,1],[1317,5,1317,6,1],[1319,9,1319,51,1],[1320,9,1320,107,1],[1321,9,1321,91,1],[1323,9,1324,33,1],[1325,9,1326,51,1],[1327,9,1328,71,1],[1329,9,1330,51,1],[1331,9,1332,51,1],[1335,9,1335,115,1],[1338,9,1338,76,1],[1339,9,1339,58,1],[1341,9,1341,115,1],[1342,9,1342,85,1],[1343,5,1343,6,1],[1347,5,1347,6,1],[1349,9,1349,51,1],[1350,9,1350,103,1],[1351,9,1351,44,1],[1353,9,1353,107,1],[1356,9,1356,59,1],[1359,9,1359,47,1],[1360,5,1360,6,1],[1364,5,1364,6,1],[1366,9,1366,51,1],[1367,9,1367,92,1],[1368,9,1368,44,1],[1370,9,1370,107,1],[1373,9,1373,60,1],[1376,9,1376,47,1],[1377,5,1377,6,1],[1381,5,1381,6,1],[1383,9,1383,51,1],[1384,9,1384,100,1],[1385,9,1385,37,1],[1386,9,1386,105,1],[1387,9,1387,41,1],[1388,9,1388,44,1],[1390,9,1390,107,1],[1391,9,1394,11,1],[1397,9,1397,59,1],[1400,9,1400,70,1],[1401,9,1401,59,1],[1403,9,1403,64,1],[1404,9,1404,49,1],[1406,9,1406,113,1],[1407,9,1407,35,1],[1408,9,1408,49,1],[1409,5,1409,6,1],[1413,5,1413,6,1],[1415,9,1415,51,1],[1416,9,1416,110,1],[1417,9,1417,105,1],[1418,9,1418,46,1],[1419,9,1419,41,1],[1420,9,1420,97,1],[1421,9,1421,37,1],[1422,9,1422,95,1],[1423,9,1423,44,1],[1425,9,1425,107,1],[1426,9,1429,11,1],[1432,9,1432,59,1],[1435,9,1435,70,1],[1436,9,1436,59,1],[1438,9,1438,64,1],[1439,9,1439,49,1],[1441,9,1441,119,1],[1442,9,1442,41,1],[1443,9,1443,55,1],[1445,9,1445,124,1],[1446,9,1446,46,1],[1447,9,1447,59,1],[1448,5,1448,6,1]]);
    </script>
  </body>
</html>