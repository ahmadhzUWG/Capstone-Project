<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>C:\Users\ahmad\Documents\GitHub\Capstone-Project\code\TaskManager\Models\ApplicationDbContext.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore;
using TaskManagerWebsite.Models;

namespace TaskManagerWebsite.Data;

public class ApplicationDbContext(DbContextOptions&lt;ApplicationDbContext&gt; options)
    : IdentityDbContext&lt;User, IdentityRole&lt;int&gt;, int&gt;(options)
{
    public DbSet&lt;User&gt; Users { get; set; }
    public DbSet&lt;Admin&gt; Admins { get; set; }
    public DbSet&lt;Group&gt; Groups { get; set; }
    public DbSet&lt;GroupManager&gt; GroupManagers { get; set; }
    public DbSet&lt;Project&gt; Projects { get; set; }
    public DbSet&lt;GroupProject&gt; GroupProjects { get; set; }

    public DbSet&lt;GroupRequest&gt; GroupRequests { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);

        // Many-to-Many Relationship: Users &lt;-&gt; Groups (General Membership)
        modelBuilder.Entity&lt;User&gt;()
            .HasMany(u =&gt; u.Groups)
            .WithMany(g =&gt; g.Users)
            .UsingEntity&lt;Dictionary&lt;string, object&gt;&gt;(
                &quot;UserGroup&quot;,
                j =&gt; j.HasOne&lt;Group&gt;().WithMany().HasForeignKey(&quot;GroupId&quot;),
                j =&gt; j.HasOne&lt;User&gt;().WithMany().HasForeignKey(&quot;UserId&quot;),
                j =&gt;
                {
                    j.HasKey(&quot;UserId&quot;, &quot;GroupId&quot;);
                    j.ToTable(&quot;UserGroups&quot;);
                });

        // One-to-One: Admin &lt;-&gt; User
        modelBuilder.Entity&lt;Admin&gt;()
            .HasOne(a =&gt; a.User)
            .WithMany()
            .HasForeignKey(a =&gt; a.UserId)
            .IsRequired()
            .OnDelete(DeleteBehavior.Cascade);

        modelBuilder.Entity&lt;GroupManager&gt;()
            .HasKey(gm =&gt; new { gm.GroupId, gm.UserId });

        modelBuilder.Entity&lt;GroupManager&gt;()
            .HasOne(gm =&gt; gm.Group)
            .WithMany(g =&gt; g.Managers)
            .HasForeignKey(gm =&gt; gm.GroupId);

        modelBuilder.Entity&lt;GroupManager&gt;()
            .HasOne(gm =&gt; gm.User)
            .WithMany()
            .HasForeignKey(gm =&gt; gm.UserId);

        modelBuilder.Entity&lt;Group&gt;()
            .HasOne(g =&gt; g.PrimaryManager)
            .WithMany()
            .HasForeignKey(g =&gt; g.PrimaryManagerId)
            .OnDelete(DeleteBehavior.Restrict);

        // Many-to-Many Relationship: Projects &lt;-&gt; Groups
        modelBuilder.Entity&lt;GroupProject&gt;()
            .HasKey(gp =&gt; new { gp.ProjectId, gp.GroupId });

        modelBuilder.Entity&lt;GroupProject&gt;()
            .HasOne(gp =&gt; gp.Project)
            .WithMany(p =&gt; p.ProjectGroups)
            .HasForeignKey(gp =&gt; gp.ProjectId);

        modelBuilder.Entity&lt;GroupProject&gt;()
            .HasOne(gp =&gt; gp.Group)
            .WithMany(g =&gt; g.GroupProjects)
            .HasForeignKey(gp =&gt; gp.GroupId);
    }

}


    </pre>
    <script type="text/javascript">
      highlightRanges([[9,7,9,63,1],[11,32,11,36,1],[11,37,11,41,1],[12,34,12,38,0],[12,39,12,43,1],[13,34,13,38,1],[13,39,13,43,1],[14,48,14,52,1],[14,53,14,57,1],[15,38,15,42,1],[15,43,15,47,1],[16,48,16,52,1],[16,53,16,57,1],[18,48,18,52,1],[18,53,18,57,1],[21,5,21,6,1],[22,9,22,44,1],[25,9,30,22,1],[30,22,30,75,1],[30,75,31,22,1],[31,22,31,73,1],[31,73,33,17,1],[33,17,33,18,1],[33,18,34,21,1],[34,21,34,51,1],[34,51,35,21,1],[35,21,35,45,1],[35,45,36,17,1],[36,17,36,18,1],[36,18,36,20,1],[39,9,44,47,1],[46,9,47,58,1],[49,9,52,46,1],[54,9,57,45,1],[59,9,63,48,1],[66,9,67,61,1],[69,9,72,48,1],[74,9,77,46,1],[78,5,78,6,1]]);
    </script>
  </body>
</html>